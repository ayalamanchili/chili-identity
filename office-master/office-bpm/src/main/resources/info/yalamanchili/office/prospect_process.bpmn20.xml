<?xml version="1.0" encoding="UTF-8"?>
<!--

    System Soft Technologies Copyright (C) 2013 ayalamanchili@sstech.mobi

-->
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<definitions
    xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
    targetNamespace="http://www.bpmnwithactiviti.org"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:activiti="http://activiti.org/bpmn">
    
    
    <process id="prospect_process">
        <startEvent id="newProspectProcessStart"/>
        <sequenceFlow sourceRef="newProspectProcessStart" targetRef="newProspectImmigrationTask" />
        <!-- Prospect Immigration Team Task -->
        <userTask id="newProspectImmigrationTask" 
                  name="New Prospect Immigration Task for ${prospect.contact.firstName} ${prospect.contact.lastName}" 
        >
            <documentation>
                New Prospect has been created with following details. 
                Navigate to MyOffice --> Prospect --> Search --> View to verify Prospect data.
                               
                Prospect                    : #{prospect.contact.firstName} #{prospect.contact.lastName} 
                Status                      : #{prospect.status}
                Case Manager                : #{caseManager}
                Assigned To                 : #{assignedTo}
                  
            </documentation>
            <extensionElements>
                <activiti:taskListener event="create" class="info.yalamanchili.office.bpm.prospect.ProspectProcess" />
                <activiti:taskListener event="complete" class="info.yalamanchili.office.bpm.prospect.ProspectProcess" />
                <activiti:formProperty id="prospectStatus" 
                                       name="ProspectStatus"
                                       required="true"
                                       type="enum">
                    <activiti:value id="recruiting" name="Recruiting"/>
                    <activiti:value id="hold" name="On Hold"/>
                </activiti:formProperty>
                <activiti:formProperty id="notes" 
                                       name="Comment"
                                       required="true" 
                                       type="string" />
            </extensionElements> 
        </userTask>
        <!-- Task escalation email after 72 hours-->
        <boundaryEvent id="prospectImmigrationTaskEscalationTimer"
                       cancelActivity="false" 
                       attachedToRef="newProspectImmigrationTask">
            <timerEventDefinition> 
                <timeDuration>PT48H</timeDuration> 
            </timerEventDefinition>
        </boundaryEvent>
        <sequenceFlow sourceRef="prospectImmigrationTaskEscalationTimer" 
                      targetRef="prospectImmigrationTaskEscalation" />
        <serviceTask id="prospectImmigrationTaskEscalation" name="Task Email Escalation" activiti:class="info.yalamanchili.office.bpm.prospect.ProspectEmailEscalation"> </serviceTask>
        <!--Decision-->
        <sequenceFlow sourceRef="newProspectImmigrationTask" 
                      targetRef="prospectRecruitmentGateway" />
        <exclusiveGateway id="prospectRecruitmentGateway" />
        <sequenceFlow sourceRef="prospectRecruitmentGateway" 
                      targetRef="newProspectRecruitmentTask">
            <conditionExpression xsi:type="tFormalExpression">
                ${prospectStatus == 'recruiting'}
            </conditionExpression>
        </sequenceFlow>
        <sequenceFlow sourceRef="prospectRecruitmentGateway" 
                      targetRef="prospectProcessEnd">
            <conditionExpression xsi:type="tFormalExpression">
                ${prospectStatus == 'hold'}
            </conditionExpression>
        </sequenceFlow>
        <!-- Prospect Recruitment Team Task -->
        <userTask id="newProspectRecruitmentTask" 
                  name="New Prospect Recruitment Task for ${prospect.contact.firstName} ${prospect.contact.lastName}" 
        >
            <documentation>
                New Prospect has been created with following details. 
                Navigate to MyOffice --> Prospect --> Search --> View to verify Prospect data.                              
                               
                Prospect                    : #{prospect.contact.firstName} #{prospect.contact.lastName} 
                Status                      : #{prospect.status}
                Case Manager                : #{caseManager}
                Assigned To                 : #{assignedTo}
                
            </documentation>
            <extensionElements>
                <activiti:taskListener event="create" class="info.yalamanchili.office.bpm.prospect.ProspectProcess" />
                <activiti:taskListener event="complete" class="info.yalamanchili.office.bpm.prospect.ProspectProcess" />
                
                <activiti:formProperty id="prospectStatus" 
                                       name="ProspectStatus"
                                       required="true"
                                       type="enum">
                    <activiti:value id="bench" name="Bench"/>
                    <activiti:value id="closedwon" name="Closed Won"/>
                    <activiti:value id="closedlost" name="Closed Lost"/>
                    <activiti:value id="hold" name="On Hold"/>
                </activiti:formProperty>
                <activiti:formProperty id="notes" 
                                       name="Comment"
                                       required="true" 
                                       type="string" />
            </extensionElements> 
        </userTask>
        <!-- Task escalation email after 48 hours-->
        <boundaryEvent id="newProspectRecruitmentTaskEscalationTimer"
                       cancelActivity="false" 
                       attachedToRef="newProspectRecruitmentTask">
            <timerEventDefinition> 
                <timeDuration>PT5M</timeDuration> 
            </timerEventDefinition>
        </boundaryEvent>
        <sequenceFlow sourceRef="newProspectRecruitmentTaskEscalationTimer" 
                      targetRef="newProspectRecruitmentTaskEscalation" />
        <serviceTask id="newProspectRecruitmentTaskEscalation" name="Task Email Escalation" activiti:class="info.yalamanchili.office.bpm.prospect.ProspectEmailEscalation"> </serviceTask>
        <!-- Task escalation email after 72 hours-->
        <boundaryEvent id="newProspectRecruitmentTaskFinalEscalationTimer"
                       cancelActivity="false" 
                       attachedToRef="newProspectRecruitmentTask">
            <timerEventDefinition> 
                <timeDuration>PT9M</timeDuration> 
            </timerEventDefinition>
        </boundaryEvent>
        <sequenceFlow sourceRef="newProspectRecruitmentTaskFinalEscalationTimer" 
                      targetRef="newProspectRecruitmentTaskFinalEscalation" />
        <serviceTask id="newProspectRecruitmentTaskFinalEscalation" name="Task Email Escalation" activiti:class="info.yalamanchili.office.bpm.prospect.ProspectFinalEmailEscalation"> </serviceTask>
        <!--desision-->
        <sequenceFlow sourceRef="newProspectRecruitmentTask" 
                      targetRef="prospectBenchGateway" />
        <exclusiveGateway id="prospectBenchGateway" />
        <sequenceFlow sourceRef="prospectBenchGateway" 
                      targetRef="newProspectBenchTask">
            <conditionExpression xsi:type="tFormalExpression">
                ${prospectStatus == 'bench'}
            </conditionExpression>
        </sequenceFlow>
        <sequenceFlow sourceRef="prospectBenchGateway" 
                      targetRef="prospectProcessEnd">
            <conditionExpression xsi:type="tFormalExpression">
                ${prospectStatus == 'hold'  or prospectStatus == 'closedwon' or prospectStatus == 'closedlost'}
            </conditionExpression>
        </sequenceFlow>
        <!-- Prospect Bench Team Task -->
        <userTask id="newProspectBenchTask" 
                  name="New Prospect Bench Task for ${prospect.contact.firstName} ${prospect.contact.lastName}" 
        >
            <documentation>
                New Prospect has been created with following details. 
                Navigate to MyOffice --> Prospect --> Search --> View to verify Prospect data.
                               
                Prospect                    : #{prospect.contact.firstName} #{prospect.contact.lastName} 
                Status                      : #{prospect.status}
                Case Manager                : #{caseManager}
                Assigned To                 : #{assignedTo}
                
            </documentation>
            <extensionElements>
                <activiti:taskListener event="create" class="info.yalamanchili.office.bpm.prospect.ProspectProcess" />
                <activiti:taskListener event="complete" class="info.yalamanchili.office.bpm.prospect.ProspectProcess" />
                <activiti:formProperty id="prospectStatus" 
                                       name="ProspectStatus"
                                       required="true"
                                       type="enum">
                    <activiti:value id="closedwon" name="Closed Won"/>
                    <activiti:value id="closedlost" name="Closed Lost"/>
                    <activiti:value id="hold" name="On Hold"/>
                </activiti:formProperty>
                <activiti:formProperty id="notes" 
                                       name="Comment"
                                       required="true" 
                                       type="string" />
            </extensionElements> 
        </userTask>
        <endEvent id="prospectProcessEnd" />
    </process>
</definitions>