<?xml version="1.0" encoding="UTF-8"?>
<!--

    System Soft Technologies Copyright (C) 2013 ayalamanchili@sstech.mobi

-->
<definitions
    xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
    targetNamespace="http://www.bpmnwithactiviti.org"
    xmlns:activiti="http://activiti.org/bpmn">
 
    <process id="address_update_process-v3">
 
        <startEvent id="updateAddressStart" />
        <sequenceFlow sourceRef="updateAddressStart" targetRef="updateAddressPayrollTask" />
        
        <!--Address Updates Task for Payroll Dept-->
        <userTask id="updateAddressPayrollTask" 
                  name="Address Updated Payroll Dept Task for ${employeeName}" 
                  activiti:candidateGroups="ROLE_PAYROLL_AND_BENIFITS">
            <documentation>
                Employee Address is updated in portal.
                1) please update in other systems as applicable. Eg: ADP, BIS, etc...
                2) complete this task once done.
                
                Address Change Notes From Employee  : ${changeNotes} 
                Street1                             : ${entity.street1}
                Street2                             : ${entity.street2}
                City                                : ${entity.city}
                State                               : ${entity.state}
                Zip                                 : ${entity.zip} 
                More Information : https://apps.sstech.us/site/office/bpm/address-updated-process.html
            </documentation>
            <extensionElements>
                <activiti:taskListener event="create" class="info.yalamanchili.office.bpm.email.GenericTaskCreateNotification" />
                <activiti:taskListener event="complete" class="info.yalamanchili.office.bpm.email.GenericTaskCompleteNotification" />
            </extensionElements>             
        </userTask>
        <sequenceFlow sourceRef="updateAddressHRTask" targetRef="updateAddressEnd" />
        <!-- Task escalation email after 7 days-->
        <boundaryEvent id="payrollTaskEmailEscalationTimer"
                       cancelActivity="false" 
                       attachedToRef="updateAddressPayrollTask">
            <timerEventDefinition> 
                <timeDuration>PT168H</timeDuration> 
            </timerEventDefinition>
        </boundaryEvent>
        <sequenceFlow sourceRef="payrollTaskEmailEscalationTimer" 
                      targetRef="payrollTaskEmailEscalation" />
        <serviceTask
            id="payrollTaskEmailEscalation"
            name="Task Email Escalation"
            activiti:class="info.yalamanchili.office.bpm.EmailEscalation">
        </serviceTask>        

       <sequenceFlow sourceRef="updateAddressStart" targetRef="updateAddressHRTask" />
        
        <!--Address Updates Task for Payroll Dept-->
        <userTask id="updateAddressHRTask" 
                  name="Address Updated - HR Dept Task for ${employeeName}" 
                  activiti:candidateGroups="ROLE_HR">
            <documentation>
                Employee Address is updated in portal.
                please update all Immigration and Related systems as applicable
                Change Notes From Employee  : ${changeNotes} 
                Employee Address is updated in portal.
                1) please update all Immigration, CITS and Related systems as applicable
                2) complete this task once done.
                
                Address Change Notes From Employee  : ${changeNotes} 
                Street1                             : ${entity.street1}
                Street2                             : ${entity.street2}
                City                                : ${entity.city}
                State                               : ${entity.state}
                Zip                                 : ${entity.zip} 
                More Information : https://apps.sstech.us/site/office/bpm/address-updated-process.html                
            </documentation>
            <extensionElements>
                <activiti:taskListener event="create" class="info.yalamanchili.office.bpm.email.GenericTaskCreateNotification" />
                <activiti:taskListener event="complete" class="info.yalamanchili.office.bpm.email.GenericTaskCompleteNotification" />
            </extensionElements>             
        </userTask>
        <sequenceFlow sourceRef="updateAddressHRTask" targetRef="updateAddressEnd" />
        <!-- Task escalation email after 7 days-->
        <boundaryEvent id="hrTaskEmailEscalationTimer"
                       cancelActivity="false" 
                       attachedToRef="updateAddressPayrollTask">
            <timerEventDefinition> 
                <timeDuration>PT168H</timeDuration> 
            </timerEventDefinition>
        </boundaryEvent>
        <sequenceFlow sourceRef="hrTaskEmailEscalationTimer" 
                      targetRef="hrTaskEmailEscalation" />
        <serviceTask
            id="hrTaskEmailEscalation"
            name="Task Email Escalation"
            activiti:class="info.yalamanchili.office.bpm.EmailEscalation">
        </serviceTask>   
        
        <endEvent id="updateAddressEnd" />
 
    </process>
 
</definitions>